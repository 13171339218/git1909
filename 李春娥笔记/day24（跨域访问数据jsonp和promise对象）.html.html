<html>
<head>
  <title>day24（跨域访问数据jsonp和promise对象）.html</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="Evernote Windows/307027 (zh-CN, DDL); Windows/6.1.0 (Win64);"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="436"/>
<h1>day24（跨域访问数据jsonp和promise对象）.html</h1>

<div>
<span><div><span style="font-size: 12pt;">梳理知识点</span></div><div style="box-sizing: border-box; padding: 8px; border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);"><div><span style="background-color: rgb(251, 250, 248);"><span style="background-color: rgb(251, 250, 248); font-size: 12pt; color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;">ajax ： </span></span></div><div><span style="background-color: rgb(251, 250, 248);"><span style="background-color: rgb(251, 250, 248); font-size: 12pt; color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;">    执行过程 ： </span></span></div><div><span style="background-color: rgb(251, 250, 248);"><span style="background-color: rgb(251, 250, 248); font-size: 12pt; color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;">        ajax对象 ： xmlHttpRequest</span></span></div><div><span style="background-color: rgb(251, 250, 248);"><span style="background-color: rgb(251, 250, 248); font-size: 12pt; color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;">        open() </span></span></div><div><span style="background-color: rgb(251, 250, 248);"><span style="background-color: rgb(251, 250, 248); font-size: 12pt; color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;">        send()</span></span></div><div><span style="background-color: rgb(251, 250, 248);"><span style="background-color: rgb(251, 250, 248); font-size: 12pt; color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;">        onreadystatechange   状态值 readyState   状态码 ： status </span></span></div><div><span style="background-color: rgb(251, 250, 248);"><span style="background-color: rgb(251, 250, 248); font-size: 12pt; color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;">        post和get区别 ： </span></span></div><div><span style="background-color: rgb(251, 250, 248);"><span style="background-color: rgb(251, 250, 248); font-size: 12pt; color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;">    缓存问题 :   </span></span></div><div><span style="background-color: rgb(251, 250, 248);"><span style="background-color: rgb(251, 250, 248); font-size: 12pt; color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;">    ajax接口 ：  路径   参数   返回值   </span></span></div><div><span style="background-color: rgb(251, 250, 248);"><span style="background-color: rgb(251, 250, 248); font-size: 12pt; color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;">     </span></span></div><div><span style="background-color: rgb(251, 250, 248);"><span style="background-color: rgb(251, 250, 248); font-size: 12pt; color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;">         </span></span></div><div><br/></div></div><div><br/></div><div><span style="font-size: 12pt;">2、同源策略</span></div><div><br/></div><div style="box-sizing: border-box; padding: 8px; border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);"><div><span style="font-size: 12pt;">同源 ： 同一个来源</span></div><div><span style="font-size: 12pt;">同源策略 ： 在ajax请求服务器文件时，保证</span> <span style="font-size: 12pt; color: rgb(255, 0, 0);">协议 域名  端口号</span><span style="font-size: 12pt;">完全一致的情况下  ，才可以访问服务器数据</span></div><div><span style="font-size: 12pt;">同源策略是浏览器的一个行业标准 ， 保证用户使用该浏览器时 数据的安全性            </span> <span style="font-size: 12pt; color: rgb(166, 0, 196);">【注】：只在接口是绝对路径下会出现同源策略</span></div><div><a href="http://127.0.0.1/" style="font-size: 12pt;">http://127.0.0.1:80</a></div><div><a href="http://127.0.0.1/" style="font-size: 12pt; color: rgb(166, 0, 196);">https://127.0.0.1:80</a><span style="font-size: 12pt;">             </span> <span style="font-size: 12pt; color: rgb(166, 0, 196);">【注】：http 和 https不是同一个协议   localhost 和 127.0.0.1 不是同一个域，虽然localhost服务器解析成127.0.0.1，但是在写绝对路径时，他们被区分为两个域</span></div><div><span style="font-size: 12pt; color: rgb(166, 0, 196);">                                    【注】：当域名不同是，浏览器会报   No 'Access-Control-Allow-Origin' header is present on the requested resource.    </span></div><div><br/></div><div><a href="http://localhost/ajax/day24/data.json" style="font-size: 12pt; color: rgb(166, 0, 196);">http://localhost/ajax/day24/data.json</a></div><div><span style="font-size: 12pt; color: rgb(166, 0, 196);">http ---   协议</span></div><div><span style="font-size: 12pt; color: rgb(166, 0, 196);">localhost --- 域名（IP）</span></div><div><span style="font-size: 12pt; color: rgb(166, 0, 196);">80 --- 端口号</span></div><div><br/></div><div><span style="font-size: 12pt; color: rgb(255, 0, 0);">ajax 受同源策略的影响，不能实现跨域访问数据 </span></div><div><span style="font-size: 12pt;">跨域 ： 在一个域下 访问 另一个域的数据 </span></div><div><br/></div></div><div><br/></div><div><span style="font-size: 12pt; color: rgb(255, 0, 0);">3、如何实现跨域访问数据 -- jsonp</span></div><div><br/></div><div style="box-sizing: border-box; padding: 8px; border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);"><div><span style="background-color: rgb(251, 250, 248);"><span style="background-color: rgb(251, 250, 248); font-size: 12pt; color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;">jsonp ： json with padding   </span><span style="background-color: rgb(251, 250, 248); font-size: 12pt; color: rgb(255, 0, 0); font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;">和ajax没关系</span><span style="background-color: rgb(251, 250, 248); font-size: 12pt; color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;">    通过这种数据访问格式 可以实现</span> <span style="background-color: rgb(251, 250, 248); font-size: 12pt; color: rgb(255, 0, 0); font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;">跨域访问数据</span></span></div><div><span style="background-color: rgb(251, 250, 248);"><span style="background-color: rgb(251, 250, 248); font-size: 12pt; color: rgb(255, 0, 0); font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;">jsonp跨域原理 ：</span></span></div><div><span style="background-color: rgb(251, 250, 248);"><span style="background-color: rgb(251, 250, 248); font-size: 12pt; color: rgb(255, 0, 0); font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;">     1、动态创建一个script标签，添加到body中                </span></span></div><div><span style="background-color: rgb(251, 250, 248);"><span style="background-color: rgb(251, 250, 248); font-size: 12pt;"><span style="background-color: rgb(251, 250, 248); font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12pt; color: rgb(255, 0, 0);">        </span><span style="font-size: 12pt; background-color: rgb(251, 250, 248); font-family: Monaco; color: rgb(134, 0, 164);">为什么要用script    ---》</span><span style="font-size: 12pt; background-color: rgb(251, 250, 248); font-family: Monaco; color: rgb(134, 0, 164);">    </span><span style="font-size: 12pt; background-color: rgb(251, 250, 248); font-family: Monaco; color: rgb(134, 0, 164);">【注】：</span><span style="font-size: 12pt;"><span style="background-color: rgb(251, 250, 248); font-family: Monaco; font-size: 12pt; color: rgb(134, 0, 164);">scrip</span></span><span style="font-size: 12pt; background-color: rgb(251, 250, 248); font-family: Monaco; color: rgb(134, 0, 164);">t标</span><span style="font-size: 12pt; background-color: rgb(251, 250, 248); font-family: Monaco; color: rgb(134, 0, 164);">签支持跨域访问</span></span></span></div><div><span style="background-color: rgb(251, 250, 248);"><span style="background-color: rgb(251, 250, 248); font-size: 12pt;"><span style="background-color: rgb(251, 250, 248); font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12pt; color: rgb(134, 0, 164);">        </span><span style="font-size: 12pt; background-color: rgb(251, 250, 248); font-family: Monaco; color: rgb(134, 0, 164);">为什么要动态创建script    ---》</span><span style="font-size: 12pt; background-color: rgb(251, 250, 248); font-family: Monaco; color: rgb(134, 0, 164);">    </span><span style="font-size: 12pt; background-color: rgb(251, 250, 248); font-family: Monaco; color: rgb(134, 0, 164);">【注】：script标签支持跨域访问</span></span></span></div><div><span style="background-color: rgb(251, 250, 248);"><span style="background-color: rgb(251, 250, 248); font-size: 12pt; color: rgb(255, 0, 0); font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;">     2、设置script标签的src属性值，属性值就是一个接口 </span><span style="background-color: rgb(251, 250, 248); font-size: 12pt; color: rgb(255, 0, 0); font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;">    </span><span style="background-color: rgb(251, 250, 248); font-size: 12pt; color: rgb(255, 0, 0); font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;"> </span> <span style="background-color: rgb(251, 250, 248); font-size: 12pt; color: rgb(166, 0, 196); font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;">              【注】：当函数参数是函数是这个函数就是回调函数，回头再调用的函数</span></span></div><div><span style="background-color: rgb(251, 250, 248);"><span style="background-color: rgb(251, 250, 248); font-size: 12pt; color: rgb(255, 0, 0); font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;">     3、通过接口上的某个参数 向服务器传递一个函数    ， 通过这个回调函数 接收服务器返回的数据             </span> <span style="background-color: rgb(251, 250, 248); font-size: 12pt; color: rgb(166, 0, 196); font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;">【注】：不过这个回调函数是有名函数</span></span></div><div><span style="background-color: rgb(251, 250, 248); font-size: 12pt; color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;">通过jsonp格式</span><span style="background-color: rgb(251, 250, 248); font-size: 12pt; color: rgb(255, 0, 0); font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;">获取的服务器数据</span> <span style="background-color: rgb(251, 250, 248); font-size: 12pt; color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;">大多数都是</span> <span style="background-color: rgb(251, 250, 248); font-size: 12pt; color: rgb(255, 0, 0); font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;">object类型</span> <span style="background-color: rgb(251, 250, 248); font-size: 12pt; color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;"> </span></div><div><span style="background-color: rgb(251, 250, 248);"><span style="background-color: rgb(251, 250, 248); font-size: 12pt; color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;">   </span> <span style="background-color: rgb(251, 250, 248); font-size: 12pt; color: rgb(166, 0, 196); font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;">【注】：这个是jsonp格式的特点，返回数据大多是 object类型，不需要转换就能使用。而一般服务器返回的数据都是string类</span><span style="background-color: rgb(251, 250, 248); font-size: 12pt; color: rgb(166, 0, 196); font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;">型，需要先转换</span><span style="background-color: rgb(251, 250, 248); font-size: 12pt; color: rgb(166, 0, 196); font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;">才能正常使用</span></span></div><div><hr/><div><br/></div></div><div><a href="https://blog.csdn.net/u010235716/article/details/51553746">https://blog.csdn.net/u010235716/article/details/51553746</a></div><div><br/></div><div><span style="font-size: 24px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(79, 79, 79); font-family: 微软雅黑; font-variant-caps: normal; font-variant-ligatures: normal;">什么是JSONP？</span></div><div><br/></div><div><span style="box-sizing: border-box; font-size: 16px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(128, 0, 0); font-family: Arial; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold; line-height: 26px;">先说说JSONP是怎么产生的：</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 14px; text-align: justify; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(79, 79, 79); font-family: Arial; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">其实网上关于JSONP的讲解有很多，但却千篇一律，而且云里雾里，对于很多刚接触的人来讲理解起来有些困难，小可不才，试着用自己的方式来阐释一下这个问题，看看是否有帮助。</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 14px; text-align: justify; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(79, 79, 79); font-family: Arial; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">1、一个众所周知的问题，Ajax直接请求普通文件存在跨域无权限访问的问题，甭管你是静态页面、动态网页、web服务、WCF，只要是跨域请求，一律不准；</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 14px; text-align: justify; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-family: Arial; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px; color: rgb(79, 79, 79);">2、不过我们又发现，Web页面上调用js文件时则不受是否跨域的影响（不仅如此，我们还发现</span><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="font-family: Arial; font-size: 14px; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px; color: rgb(134, 0, 164);">凡是拥有&quot;src&quot;这个属性的标签都拥有跨域的能力，比如&lt;script&gt;、&lt;img&gt;、&lt;iframe&gt;</span></span><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-family: Arial; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px; color: rgb(79, 79, 79);">）；</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 14px; text-align: justify; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(79, 79, 79); font-family: Arial; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">3、于是可以判断，当前阶段如果想通过纯web端（ActiveX控件、服务端代理、属于未来的HTML5之Websocket等方式不算）跨域访问数据就只有一种可能，那就是在远程服务器上设法把数据装进js格式的文件里，供客户端调用和进一步处理；</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 14px; text-align: justify; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(79, 79, 79); font-family: Arial; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">4、恰巧我们已经知道有一种叫做JSON的纯字符数据格式可以简洁的描述复杂数据，更妙的是JSON还被js原生支持，所以在客户端几乎可以随心所欲的处理这种格式的数据；</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 14px; text-align: justify; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(79, 79, 79); font-family: Arial; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">5、这样子解决方案就呼之欲出了，web客户端通过与调用脚本一模一样的方式，来调用跨域服务器上动态生成的js格式文件（一般以JSON为后缀），显而易见，服务器之所以要动态生成JSON文件，目的就在于把客户端需要的数据装入进去。</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 14px; text-align: justify; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(79, 79, 79); font-family: Arial; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">6、客户端在对JSON文件调用成功之后，也就获得了自己所需的数据，剩下的就是按照自己需求进行处理和展现了，这种获取远程数据的方式看起来非常像AJAX，但其实并不一样。</span></div><div style="margin: 0px; padding: 0px; box-sizing: border-box; font-size: 14px; text-align: justify; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(79, 79, 79); font-family: Arial; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">7、为了便于客户端使用数据，逐渐形成了一种非正式传输协议，人们把它称作JSONP，该协议的一个要点就是允许用户传递一个callback参数给服务端，然后服务端返回数据时会将这个callback参数作为函数名来包裹住JSON数据，这样客户端就可以随意定制自己的函数来自动处理返回数据了。</span></div><div><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(79, 79, 79); font-family: Arial; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">如果对于callback参数如何使用还有些模糊的话，我们后面会有具体的实例来讲解。</span></div><div><br/></div></div><div><br/></div><div><span style="font-size: 12pt;">4、cors跨域</span></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><font style="font-size: 12pt;">用于服务器的跨域请求数据        <font color="#41AD1C">cors：跨域资源共享</font></font></div><div><span style="min-height: 18pt; font-family: consolas; color: rgb(149, 163, 171);"><font style="font-size: 12pt;"> 任何域下都可以访问 </font></span></div><div><font style="font-size: 12pt;"><span style="min-height: 18pt; font-family: consolas; color: rgb(1, 1, 1);"> </span><span style="min-height: 18pt; font-family: consolas; color: rgb(8, 8, 8);">header(</span><span style="min-height: 18pt; font-family: consolas; color: rgb(36, 140, 133);">&quot;Access-Control-Allow-Origin:*&quot;</span><span style="min-height: 18pt; font-family: consolas; color: rgb(8, 8, 8);">);</span></font></div></div><div><br/></div><div><span style="font-size: 12pt;">5、promise  对象</span></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><font style="font-size: 12pt;">promise ： 承诺              </font></div><div><font style="font-size: 12pt;">promise对象有三种状态 ： pending 进行中            <font color="#41AD1C">pending：在...期间，有待</font></font></div><div><font style="font-size: 12pt;">                       resolved 已解决            <font color="#41AD1C">resolved：已解决的</font></font></div><div><font style="font-size: 12pt;">                       rejected 失败                <font color="#41AD1C">rejected：被拒的</font></font></div><div><br/></div><div><font style="font-size: 12pt;">promise对象特点：</font></div><div><font style="font-size: 12pt;">    不可逆的  （结果唯一，如果执行success ，不会再执行failed）</font></div><div><font style="font-size: 12pt;">    如果承诺的事情成功了   会执行promise对象的then方法 ， then方法中可以接受两个匿名函数，第一个表示成功后执行，第二个表示失败后执行</font></div><div><font style="font-size: 12pt;">    如果承诺的事情 失败  会执行promise对象的  catch方法</font></div><div><font style="font-size: 12pt;">   </font></div><div><font style="font-size: 12pt;"> </font></div></div><div><br/></div><div><span style="font-size: 12pt;">promise   封装函数访问ajax</span></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><br/></div><div><font style="font-size: 12pt;"><span style="min-height: 20pt; font-family: Consolas; color: rgb(62, 75, 83);">&lt;</span><span style="min-height: 20pt; font-family: Consolas; color: rgb(35, 105, 182);">script</span><span style="min-height: 20pt; font-family: Consolas; color: rgb(62, 75, 83);">&gt;</span></font></div><div style="min-height: 20pt;"><font style="font-size: 12pt;"><span style="min-height: 20pt; font-family: Consolas; color: rgb(1, 1, 1);">    </span><span style="min-height: 20pt; font-family: Consolas; color: rgb(60, 122, 3);">window</span><span style="min-height: 20pt; font-family: Consolas; color: rgb(8, 8, 8);">.</span><span style="min-height: 20pt; font-family: Consolas; color: rgb(219, 120, 0);">onload</span> <span style="min-height: 20pt; font-family: Consolas; color: rgb(87, 121, 9);">=</span> <span style="min-height: 20pt; font-family: Consolas; color: rgb(54, 75, 192);">function</span><span style="min-height: 20pt; font-family: Consolas; color: rgb(8, 8, 8);">(){</span></font></div><div style="min-height: 20pt;"><font style="font-size: 12pt;"><span style="min-height: 20pt; font-family: Consolas; color: rgb(8, 8, 8);">       </span><span style="min-height: 20pt; font-family: Consolas; color: rgb(54, 75, 192);">var</span> <span style="min-height: 20pt; font-family: Consolas; color: rgb(8, 8, 8);">pro</span> <span style="min-height: 20pt; font-family: Consolas; color: rgb(87, 121, 9);">=</span> <span style="min-height: 20pt; font-family: Consolas; color: rgb(8, 8, 8);">ajaxPromise(</span><span style="min-height: 20pt; font-family: Consolas; color: rgb(36, 140, 133);">&quot;data1.json&quot;</span><span style="min-height: 20pt; font-family: Consolas; color: rgb(8, 8, 8);">);</span></font></div><div style="min-height: 20pt;"><font style="font-size: 12pt;"><span style="min-height: 20pt; font-family: Consolas; color: rgb(8, 8, 8);">       pro.</span><span style="min-height: 20pt; font-family: Consolas; color: rgb(219, 120, 0);">then</span><span style="min-height: 20pt; font-family: Consolas; color: rgb(8, 8, 8);">(</span><span style="min-height: 20pt; font-family: Consolas; color: rgb(54, 75, 192);">function</span><span style="min-height: 20pt; font-family: Consolas; color: rgb(8, 8, 8);">(</span><span style="min-height: 20pt; font-family: Consolas; color: rgb(165, 120, 0);">msg</span><span style="min-height: 20pt; font-family: Consolas; color: rgb(8, 8, 8);">){</span></font></div><div style="min-height: 20pt;"><span style="min-height: 20pt; font-family: Consolas; color: rgb(8, 8, 8);"><font style="font-size: 12pt;">           alert(msg)</font></span></div><div style="min-height: 20pt;"><font style="font-size: 12pt;"><span style="min-height: 20pt; font-family: Consolas; color: rgb(8, 8, 8);">       },</span><span style="min-height: 20pt; font-family: Consolas; color: rgb(54, 75, 192);">function</span><span style="min-height: 20pt; font-family: Consolas; color: rgb(8, 8, 8);">(</span><span style="min-height: 20pt; font-family: Consolas; color: rgb(165, 120, 0);">msg</span><span style="min-height: 20pt; font-family: Consolas; color: rgb(8, 8, 8);">){</span></font></div><div style="min-height: 20pt;"><span style="min-height: 20pt; font-family: Consolas; color: rgb(8, 8, 8);"><font style="font-size: 12pt;">           alert(msg)</font></span></div><div style="min-height: 20pt;"><span style="min-height: 20pt; font-family: Consolas; color: rgb(8, 8, 8);"><font style="font-size: 12pt;">       });</font></span></div><div style="min-height: 20pt;"><span style="min-height: 20pt; font-family: Consolas; color: rgb(8, 8, 8);"><font style="font-size: 12pt;">    }</font></span></div><div style="min-height: 20pt;"><span style="min-height: 20pt; font-family: Consolas; color: rgb(8, 8, 8);"><font style="font-size: 12pt;">    </font></span></div><div style="min-height: 20pt;"><span style="min-height: 20pt; font-family: Consolas; color: rgb(8, 8, 8);"><font style="font-size: 12pt;">    </font></span></div><div style="min-height: 20pt;"><font style="font-size: 12pt;"><span style="min-height: 20pt; font-family: Consolas; color: rgb(8, 8, 8);">    </span><span style="min-height: 20pt; font-family: Consolas; color: rgb(149, 163, 171);">//通过promise访问ajax</span></font></div><div style="min-height: 20pt;"><font style="font-size: 12pt;"><span style="min-height: 20pt; font-family: Consolas; color: rgb(1, 1, 1);">    </span><span style="min-height: 20pt; font-family: Consolas; color: rgb(54, 75, 192);">function</span> <span style="min-height: 20pt; font-family: Consolas; color: rgb(219, 120, 0);">ajaxPromise</span><span style="min-height: 20pt; font-family: Consolas; color: rgb(8, 8, 8);">(</span><span style="min-height: 20pt; font-family: Consolas; color: rgb(165, 120, 0);">url</span><span style="min-height: 20pt; font-family: Consolas; color: rgb(8, 8, 8);">,</span><span style="min-height: 20pt; font-family: Consolas; color: rgb(165, 120, 0);">data</span><span style="min-height: 20pt; font-family: Consolas; color: rgb(8, 8, 8);">){</span></font></div><div style="min-height: 20pt;"><font style="font-size: 12pt;"><span style="min-height: 20pt; font-family: Consolas; color: rgb(8, 8, 8);">       </span><span style="min-height: 20pt; font-family: Consolas; color: rgb(87, 121, 9);">if</span><span style="min-height: 20pt; font-family: Consolas; color: rgb(8, 8, 8);">(</span> <span style="min-height: 20pt; font-family: Consolas; color: rgb(60, 122, 3);">arguments</span><span style="min-height: 20pt; font-family: Consolas; color: rgb(8, 8, 8);">.length</span> <span style="min-height: 20pt; font-family: Consolas; color: rgb(87, 121, 9);">==</span> <span style="min-height: 20pt; font-family: Consolas; color: rgb(155, 28, 235);">2</span> <span style="min-height: 20pt; font-family: Consolas; color: rgb(8, 8, 8);">){</span></font></div><div style="min-height: 20pt;"><font style="font-size: 12pt;"><span style="min-height: 20pt; font-family: Consolas; color: rgb(8, 8, 8);">           </span><span style="min-height: 20pt; font-family: Consolas; color: rgb(60, 122, 3);">url</span> <span style="min-height: 20pt; font-family: Consolas; color: rgb(87, 121, 9);">=</span> <span style="min-height: 20pt; font-family: Consolas; color: rgb(60, 122, 3);">url</span> <span style="min-height: 20pt; font-family: Consolas; color: rgb(87, 121, 9);">+</span> <span style="min-height: 20pt; font-family: Consolas; color: rgb(36, 140, 133);">&quot;?&quot;</span> <span style="min-height: 20pt; font-family: Consolas; color: rgb(87, 121, 9);">+</span> <span style="min-height: 20pt; font-family: Consolas; color: rgb(8, 8, 8);">data;</span></font></div><div style="min-height: 20pt;"><span style="min-height: 20pt; font-family: Consolas; color: rgb(8, 8, 8);"><font style="font-size: 12pt;">       }</font></span></div><div style="min-height: 20pt;"><font style="font-size: 12pt;"><span style="min-height: 20pt; font-family: Consolas; color: rgb(8, 8, 8);">       </span><span style="min-height: 20pt; font-family: Consolas; color: rgb(54, 75, 192);">var</span> <span style="min-height: 20pt; font-family: Consolas; color: rgb(8, 8, 8);">pro</span> <span style="min-height: 20pt; font-family: Consolas; color: rgb(87, 121, 9);">= new</span> <span style="min-height: 20pt; font-family: Consolas; color: rgb(219, 120, 0);">Promise</span><span style="min-height: 20pt; font-family: Consolas; color: rgb(8, 8, 8);">(</span><span style="min-height: 20pt; font-family: Consolas; color: rgb(54, 75, 192);">function</span><span style="min-height: 20pt; font-family: Consolas; color: rgb(8, 8, 8);">(</span><span style="min-height: 20pt; font-family: Consolas; color: rgb(165, 120, 0);">success</span><span style="min-height: 20pt; font-family: Consolas; color: rgb(8, 8, 8);">,</span><span style="min-height: 20pt; font-family: Consolas; color: rgb(165, 120, 0);">failed</span><span style="min-height: 20pt; font-family: Consolas; color: rgb(8, 8, 8);">){</span></font></div><div style="min-height: 20pt;"><font style="font-size: 12pt;"><span style="min-height: 20pt; font-family: Consolas; color: rgb(8, 8, 8);">           </span><span style="min-height: 20pt; font-family: Consolas; color: rgb(54, 75, 192);">var</span> <span style="min-height: 20pt; font-family: Consolas; color: rgb(8, 8, 8);">ajax</span> <span style="min-height: 20pt; font-family: Consolas; color: rgb(87, 121, 9);">=</span> <span style="min-height: 20pt; font-family: Consolas; color: rgb(155, 28, 235);">null</span><span style="min-height: 20pt; font-family: Consolas; color: rgb(8, 8, 8);">;</span></font></div><div style="min-height: 20pt;"><font style="font-size: 12pt;"><span style="min-height: 20pt; font-family: Consolas; color: rgb(8, 8, 8);">           </span><span style="min-height: 20pt; font-family: Consolas; color: rgb(87, 121, 9);">if</span><span style="min-height: 20pt; font-family: Consolas; color: rgb(8, 8, 8);">(</span> <span style="min-height: 20pt; font-family: Consolas; color: rgb(60, 122, 3);">window</span><span style="min-height: 20pt; font-family: Consolas; color: rgb(8, 8, 8);">.XMLHttpRequest ){</span></font></div><div style="min-height: 20pt;"><font style="font-size: 12pt;"><span style="min-height: 20pt; font-family: Consolas; color: rgb(8, 8, 8);">               ajax</span> <span style="min-height: 20pt; font-family: Consolas; color: rgb(87, 121, 9);">= new</span> <span style="min-height: 20pt; font-family: Consolas; color: rgb(8, 8, 8);">XMLHttpRequest();</span></font></div><div style="min-height: 20pt;"><font style="font-size: 12pt;"><span style="min-height: 20pt; font-family: Consolas; color: rgb(8, 8, 8);">           }</span><span style="min-height: 20pt; font-family: Consolas; color: rgb(87, 121, 9);">else</span><span style="min-height: 20pt; font-family: Consolas; color: rgb(8, 8, 8);">{</span></font></div><div style="min-height: 20pt;"><font style="font-size: 12pt;"><span style="min-height: 20pt; font-family: Consolas; color: rgb(8, 8, 8);">               ajax</span> <span style="min-height: 20pt; font-family: Consolas; color: rgb(87, 121, 9);">= new</span> <span style="min-height: 20pt; font-family: Consolas; color: rgb(8, 8, 8);">ActiveXObject(</span><span style="min-height: 20pt; font-family: Consolas; color: rgb(36, 140, 133);">&quot;Microsoft.XMLHTTP&quot;</span><span style="min-height: 20pt; font-family: Consolas; color: rgb(8, 8, 8);">);</span></font></div><div style="min-height: 20pt;"><span style="min-height: 20pt; font-family: Consolas; color: rgb(8, 8, 8);"><font style="font-size: 12pt;">           }</font></span></div><div style="min-height: 20pt;"><font style="font-size: 12pt;"><span style="min-height: 20pt; font-family: Consolas; color: rgb(8, 8, 8);">           ajax.open(</span><span style="min-height: 20pt; font-family: Consolas; color: rgb(36, 140, 133);">&quot;get&quot;</span><span style="min-height: 20pt; font-family: Consolas; color: rgb(8, 8, 8);">,</span><span style="min-height: 20pt; font-family: Consolas; color: rgb(60, 122, 3);">url</span><span style="min-height: 20pt; font-family: Consolas; color: rgb(8, 8, 8);">);</span></font></div><div style="min-height: 20pt;"><span style="min-height: 20pt; font-family: Consolas; color: rgb(8, 8, 8);"><font style="font-size: 12pt;">           ajax.send();</font></span></div><div style="min-height: 20pt;"><font style="font-size: 12pt;"><span style="min-height: 20pt; font-family: Consolas; color: rgb(8, 8, 8);">           ajax.</span><span style="min-height: 20pt; font-family: Consolas; color: rgb(219, 120, 0);">onreadystatechange</span> <span style="min-height: 20pt; font-family: Consolas; color: rgb(87, 121, 9);">=</span> <span style="min-height: 20pt; font-family: Consolas; color: rgb(54, 75, 192);">function</span><span style="min-height: 20pt; font-family: Consolas; color: rgb(8, 8, 8);">(){</span></font></div><div style="min-height: 20pt;"><font style="font-size: 12pt;"><span style="min-height: 20pt; font-family: Consolas; color: rgb(8, 8, 8);">               </span><span style="min-height: 20pt; font-family: Consolas; color: rgb(87, 121, 9);">if</span><span style="min-height: 20pt; font-family: Consolas; color: rgb(8, 8, 8);">( ajax.status</span><span style="min-height: 20pt; font-family: Consolas; color: rgb(87, 121, 9);">==</span><span style="min-height: 20pt; font-family: Consolas; color: rgb(155, 28, 235);">200</span> <span style="min-height: 20pt; font-family: Consolas; color: rgb(87, 121, 9);">&amp;&amp;</span> <span style="min-height: 20pt; font-family: Consolas; color: rgb(8, 8, 8);">ajax.readyState</span><span style="min-height: 20pt; font-family: Consolas; color: rgb(87, 121, 9);">==</span><span style="min-height: 20pt; font-family: Consolas; color: rgb(155, 28, 235);">4</span> <span style="min-height: 20pt; font-family: Consolas; color: rgb(8, 8, 8);">){</span></font></div><div style="min-height: 11pt;"><span style="min-height: 11pt; font-family: Consolas; color: rgb(8, 8, 8);"><font style="font-size: 12pt;">                   success(ajax.responseText)</font></span></div><div style="min-height: 20pt;"><span style="min-height: 20pt; font-family: Consolas; color: rgb(8, 8, 8);"><font style="font-size: 12pt;">               }</font></span></div><div style="min-height: 20pt;"><span style="min-height: 20pt; font-family: Consolas; color: rgb(8, 8, 8);"><font style="font-size: 12pt;">           }</font></span></div><div style="min-height: 20pt;"><font style="font-size: 12pt;"><span style="min-height: 20pt; font-family: Consolas; color: rgb(8, 8, 8);">           </span><span style="min-height: 20pt; font-family: Consolas; color: rgb(219, 120, 0);">setTimeout</span><span style="min-height: 20pt; font-family: Consolas; color: rgb(8, 8, 8);">(</span><span style="min-height: 20pt; font-family: Consolas; color: rgb(54, 75, 192);">function</span><span style="min-height: 20pt; font-family: Consolas; color: rgb(8, 8, 8);">(){</span></font></div><div style="min-height: 20pt;"><font style="font-size: 12pt;"><span style="min-height: 20pt; font-family: Consolas; color: rgb(8, 8, 8);">               failed(</span><span style="min-height: 20pt; font-family: Consolas; color: rgb(36, 140, 133);">&quot;请求数据失败&quot;</span><span style="min-height: 20pt; font-family: Consolas; color: rgb(8, 8, 8);">);</span></font></div><div style="min-height: 20pt;"><font style="font-size: 12pt;"><span style="min-height: 20pt; font-family: Consolas; color: rgb(8, 8, 8);">           },</span><span style="min-height: 20pt; font-family: Consolas; color: rgb(155, 28, 235);">5000</span><span style="min-height: 20pt; font-family: Consolas; color: rgb(8, 8, 8);">);</span></font></div><div style="min-height: 20pt;"><span style="min-height: 20pt; font-family: Consolas; color: rgb(8, 8, 8);"><font style="font-size: 12pt;">       });</font></span></div><div style="min-height: 20pt;"><font style="font-size: 12pt;"><span style="min-height: 20pt; font-family: Consolas; color: rgb(8, 8, 8);">       </span><span style="min-height: 20pt; font-family: Consolas; color: rgb(87, 121, 9);">return</span> <span style="min-height: 20pt; font-family: Consolas; color: rgb(8, 8, 8);">pro;</span></font></div><div style="min-height: 20pt;"><span style="min-height: 20pt; font-family: Consolas; color: rgb(8, 8, 8);"><font style="font-size: 12pt;">    }</font></span></div><div style="min-height: 20pt;"><font style="font-size: 12pt;"><span style="min-height: 20pt; font-family: Consolas; color: rgb(62, 75, 83);">&lt;/</span><span style="min-height: 20pt; font-family: Consolas; color: rgb(35, 105, 182);">script</span><span style="min-height: 20pt; font-family: Consolas; color: rgb(62, 75, 83);">&gt;</span></font></div><div style="min-height: 20pt;"><div><br/></div></div></div><div><br/></div><div>promise</div><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><br/></div><div><span style="box-sizing: border-box; outline: 0px; word-break: break-all; color: rgb(51, 51, 51); font-size: 15.36px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-family: &quot;Microsoft YaHei&quot;;">1.优点和缺点</span></div><div><span style="box-sizing: border-box; outline: 0px; word-break: break-all; color: rgb(51, 51, 51); font-size: 15.36px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-family: Verdana, Arial;">可以将异步操作以同步操作的流程表达出来，避免了层层嵌套的回调函数。此外，Promise对象提供统一的接口，使得控制异步操作更加容易。</span></div><div><br style="box-sizing: border-box; outline: 0px; word-break: break-all; color: rgb(51, 51, 51); font-family: &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, SimHei, Arial, SimSun; font-size: 15.36px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"/></div><div><span style="box-sizing: border-box; outline: 0px; word-break: break-all; color: rgb(51, 51, 51); font-size: 15.36px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-family: Verdana, Arial;">Promise也有一些缺点。首先，无法取消Promise，一旦新建它就会立即执行，无法中途取消。其次，如果不设置回调函数，Promise内部抛出的错误，不会反应到外部。当处于Pending状态时，无法得知目前进展到哪一个阶段（刚刚开始还是即将完成）。</span></div><div><br style="box-sizing: border-box; outline: 0px; word-break: break-all; color: rgb(51, 51, 51); font-family: &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, SimHei, Arial, SimSun; font-size: 15.36px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"/></div><div><span style="box-sizing: border-box; outline: 0px; word-break: break-all; color: rgb(51, 51, 51); font-size: 15.36px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-family: Verdana, Arial;">2.规范</span></div><div><span style="box-sizing: border-box; outline: 0px; word-break: break-all; color: rgb(51, 51, 51); font-size: 15.36px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-family: Verdana, Arial;">Promise 对象有三种状态： Pending – Promise对象的初始状态，等到任务的完成或者被拒绝；Resolved – 任务执行完成并且成功的状态；Rejected – 任务执行完成并且失败的状态；</span></div><div><span style="box-sizing: border-box; outline: 0px; word-break: break-all; color: rgb(51, 51, 51); font-size: 15.36px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-family: Verdana, Arial;">Promise的状态只可能从Pending状态转到Resolved状态或者Rejected状态，而且不能逆向转换，同时Resolved状态和Rejected状态也不能相互转换；</span></div><div><span style="box-sizing: border-box; outline: 0px; word-break: break-all; color: rgb(51, 51, 51); font-size: 15.36px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-family: Verdana, Arial;">Promise对象必须实现then方法，then是promise规范的核心，而且then方法也必须返回一个Promise对象，同一个Promise对象可以注册多个then方法，并且回调的执行顺序跟它们的注册顺序一致；</span></div><div><span style="box-sizing: border-box; outline: 0px; word-break: break-all; color: rgb(51, 51, 51); font-size: 15.36px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-family: Verdana, Arial;">then方法接受两个回调函数，它们分别为：成功时的回调和失败时的回调；并且它们分别在：Promise由Pending状态转换到Resolved状态时被调用和在Promise由Pending状态转换到Rejected状态时被调用。</span></div><div><span style="box-sizing: border-box; outline: 0px; word-break: break-all; color: rgb(51, 51, 51); font-size: 15.36px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-family: Verdana, Arial;"><br/></span></div><div><span style="box-sizing: border-box; outline: 0px; font-size: 15.36px; color: rgb(51, 51, 51); line-height: 26px; word-break: break-all; font-family: &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, SimHei, Arial, SimSun; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">3.特性</span></div><div><span style="box-sizing: border-box; outline: 0px; font-size: 15.36px; color: rgb(51, 51, 51); line-height: 26px; word-break: break-all; font-family: &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, SimHei, Arial, SimSun; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;">3-1.立即执行性</span></div><div><span style="box-sizing: border-box; outline: 0px; font-size: 15.36px; color: rgb(51, 51, 51); line-height: 26px; word-break: break-all; font-family: &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, SimHei, Arial, SimSun; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><br/></span></div><div><span style="min-height: 16pt; font-family: consolas; color: rgb(54, 75, 192); font-size: 14pt;">var</span> <span style="min-height: 16pt; font-family: consolas; color: rgb(8, 8, 8); font-size: 14pt;">p</span><span style="min-height: 16pt; font-family: consolas; color: rgb(87, 121, 9); font-size: 14pt;">=new</span> <span style="min-height: 16pt; font-family: consolas; color: rgb(219, 120, 0); font-size: 14pt;">Promise</span><span style="min-height: 16pt; font-family: consolas; color: rgb(8, 8, 8); font-size: 14pt;">(</span><span style="min-height: 16pt; font-family: consolas; color: rgb(54, 75, 192); font-size: 14pt;">function</span><span style="min-height: 16pt; font-family: consolas; color: rgb(8, 8, 8); font-size: 14pt;">(</span><span style="min-height: 16pt; font-family: consolas; color: rgb(165, 120, 0); font-size: 14pt;">resolve</span><span style="min-height: 16pt; font-family: consolas; color: rgb(8, 8, 8); font-size: 14pt;">,</span><span style="min-height: 16pt; font-family: consolas; color: rgb(165, 120, 0); font-size: 14pt;">reject</span><span style="min-height: 16pt; font-family: consolas; color: rgb(8, 8, 8); font-size: 14pt;">){ </span> <span style="min-height: 16pt; font-family: consolas; color: rgb(149, 163, 171); font-size: 14pt;">//promise对象内部是同步执行，then和catch是异步</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: consolas; color: rgb(1, 1, 1); font-size: 14pt;">   </span> <span style="min-height: 16pt; font-family: consolas; color: rgb(60, 122, 3); font-size: 14pt;">console</span><span style="min-height: 16pt; font-family: consolas; color: rgb(8, 8, 8); font-size: 14pt;">.log(</span><span style="min-height: 16pt; font-family: consolas; color: rgb(36, 140, 133); font-size: 14pt;">&quot;create new promise1&quot;</span><span style="min-height: 16pt; font-family: consolas; color: rgb(8, 8, 8); font-size: 14pt;">); </span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: consolas; color: rgb(8, 8, 8); font-size: 14pt;">    resolve(</span><span style="min-height: 16pt; font-family: consolas; color: rgb(36, 140, 133); font-size: 14pt;">&quot;success3&quot;</span><span style="min-height: 16pt; font-family: consolas; color: rgb(8, 8, 8); font-size: 14pt;">); </span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: consolas; color: rgb(8, 8, 8); font-size: 14pt;">}); </span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: consolas; color: rgb(8, 8, 8); font-size: 14pt;"> </span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: consolas; color: rgb(8, 8, 8); font-size: 14pt;">p.</span><span style="min-height: 16pt; font-family: consolas; color: rgb(219, 120, 0); font-size: 14pt;">then</span><span style="min-height: 16pt; font-family: consolas; color: rgb(8, 8, 8); font-size: 14pt;">(</span><span style="min-height: 16pt; font-family: consolas; color: rgb(54, 75, 192); font-size: 14pt;">function</span><span style="min-height: 16pt; font-family: consolas; color: rgb(8, 8, 8); font-size: 14pt;">(</span><span style="min-height: 16pt; font-family: consolas; color: rgb(165, 120, 0); font-size: 14pt;">value</span><span style="min-height: 16pt; font-family: consolas; color: rgb(8, 8, 8); font-size: 14pt;">){ </span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: consolas; color: rgb(8, 8, 8); font-size: 14pt;">   </span> <span style="min-height: 16pt; font-family: consolas; color: rgb(60, 122, 3); font-size: 14pt;">console</span><span style="min-height: 16pt; font-family: consolas; color: rgb(8, 8, 8); font-size: 14pt;">.log(value); </span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: consolas; color: rgb(8, 8, 8); font-size: 14pt;">});</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: consolas; color: rgb(60, 122, 3); font-size: 14pt;">console</span><span style="min-height: 16pt; font-family: consolas; color: rgb(8, 8, 8); font-size: 14pt;">.log(</span><span style="min-height: 16pt; font-family: consolas; color: rgb(36, 140, 133); font-size: 14pt;">&quot;after new  promise2&quot;</span><span style="min-height: 16pt; font-family: consolas; color: rgb(8, 8, 8); font-size: 14pt;">); </span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: consolas; color: rgb(8, 8, 8); font-size: 14pt;"> </span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: consolas; color: rgb(8, 8, 8); font-size: 14pt;"> </span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: consolas; color: rgb(149, 163, 171); font-size: 14pt;">//create new promise 1</span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: consolas; color: rgb(149, 163, 171); font-size: 14pt;">//after new  promise 2</span></div><div><span style="min-height: 16pt; font-family: consolas; color: rgb(149, 163, 171); font-size: 14pt;">//success 3</span></div><div><span style="min-height: 16pt; font-family: consolas; color: rgb(149, 163, 171); font-size: 14pt;"><br/></span></div><div><span style="color: rgb(51, 51, 51); font-family: &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, SimHei, Arial, SimSun; font-size: 14px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">3-3.</span><span style="color: rgb(51, 51, 51); font-family: &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, SimHei, Arial, SimSun; font-size: 14px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;">then() 回调异步性</span></div><div><span style="color: rgb(51, 51, 51); font-family: &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, SimHei, Arial, SimSun; font-size: 14px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><br/></span></div><div><span style="min-height: 16pt; font-family: consolas; color: rgb(54, 75, 192); font-size: 14pt;">var</span> <span style="min-height: 16pt; font-family: consolas; color: rgb(8, 8, 8); font-size: 14pt;">p</span> <span style="min-height: 16pt; font-family: consolas; color: rgb(87, 121, 9); font-size: 14pt;">= new</span> <span style="min-height: 16pt; font-family: consolas; color: rgb(219, 120, 0); font-size: 14pt;">Promise</span><span style="min-height: 16pt; font-family: consolas; color: rgb(8, 8, 8); font-size: 14pt;">(</span><span style="min-height: 16pt; font-family: consolas; color: rgb(54, 75, 192); font-size: 14pt;">function</span><span style="min-height: 16pt; font-family: consolas; color: rgb(8, 8, 8); font-size: 14pt;">(</span><span style="min-height: 16pt; font-family: consolas; color: rgb(165, 120, 0); font-size: 14pt;">resolve</span><span style="min-height: 16pt; font-family: consolas; color: rgb(8, 8, 8); font-size: 14pt;">,</span> <span style="min-height: 16pt; font-family: consolas; color: rgb(165, 120, 0); font-size: 14pt;">reject</span><span style="min-height: 16pt; font-family: consolas; color: rgb(8, 8, 8); font-size: 14pt;">){ </span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: consolas; color: rgb(8, 8, 8); font-size: 14pt;">  resolve(</span><span style="min-height: 16pt; font-family: consolas; color: rgb(36, 140, 133); font-size: 14pt;">&quot;success&quot;</span><span style="min-height: 16pt; font-family: consolas; color: rgb(8, 8, 8); font-size: 14pt;">); </span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: consolas; color: rgb(8, 8, 8); font-size: 14pt;">}); </span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: consolas; color: rgb(8, 8, 8); font-size: 14pt;"> </span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: consolas; color: rgb(8, 8, 8); font-size: 14pt;">p.</span><span style="min-height: 16pt; font-family: consolas; color: rgb(219, 120, 0); font-size: 14pt;">then</span><span style="min-height: 16pt; font-family: consolas; color: rgb(8, 8, 8); font-size: 14pt;">(</span><span style="min-height: 16pt; font-family: consolas; color: rgb(54, 75, 192); font-size: 14pt;">function</span><span style="min-height: 16pt; font-family: consolas; color: rgb(8, 8, 8); font-size: 14pt;">(</span><span style="min-height: 16pt; font-family: consolas; color: rgb(165, 120, 0); font-size: 14pt;">value</span><span style="min-height: 16pt; font-family: consolas; color: rgb(8, 8, 8); font-size: 14pt;">){ </span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: consolas; color: rgb(8, 8, 8); font-size: 14pt;"> </span> <span style="min-height: 16pt; font-family: consolas; color: rgb(60, 122, 3); font-size: 14pt;">console</span><span style="min-height: 16pt; font-family: consolas; color: rgb(8, 8, 8); font-size: 14pt;">.log(value); </span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: consolas; color: rgb(8, 8, 8); font-size: 14pt;">}); </span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: consolas; color: rgb(8, 8, 8); font-size: 14pt;"> </span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: consolas; color: rgb(60, 122, 3); font-size: 14pt;">console</span><span style="min-height: 16pt; font-family: consolas; color: rgb(8, 8, 8); font-size: 14pt;">.log(</span><span style="min-height: 16pt; font-family: consolas; color: rgb(36, 140, 133); font-size: 14pt;">&quot;first&quot;</span><span style="min-height: 16pt; font-family: consolas; color: rgb(8, 8, 8); font-size: 14pt;">); </span></div><div style="min-height: 16pt;"><span style="min-height: 16pt; font-family: consolas; color: rgb(149, 163, 171); font-size: 14pt;">//&quot;first&quot; </span></div><div><span style="min-height: 16pt; font-family: consolas; color: rgb(149, 163, 171); font-size: 14pt;">//&quot;success&quot;</span></div><div><br/></div></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div></span>
</div></body></html> 